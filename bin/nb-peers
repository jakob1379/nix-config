#!/usr/bin/env bash
set -euo pipefail

# Description: Extracts peer details from netbird status.
# Usage: nb-peers [netbird-binary] (defaults to 'netbird')

readonly NB_CMD="${1:-netbird}"

if [[ "${NB_CMD}" == "-h" || "${NB_CMD}" == "--help" ]]; then
  echo "Usage: $(basename "$0") [netbird-binary]"
  echo "  If binary is omitted, defaults to 'netbird'."
  exit 0
fi

"${NB_CMD}" status --json | jq -r '.peers.details[] | {fqdn, netbirdIp, status, connectionType}'
